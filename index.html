<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CELPIP Daily Vocab (400)</title>

  <!-- Supabase client (email/password auth + sync). Provides window.supabase (library). -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root { --bg:#0b0f17; --card:#121a27; --muted:#9fb0c7; --text:#eaf1ff; --accent:#6aa6ff; --good:#2fe59b; --warn:#ffcc66; --bad:#ff6a7a; }
    * { box-sizing:border-box; }
    body {
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 20% 0%, #16233b 0%, var(--bg) 55%);
      color:var(--text);
    }
    .wrap { max-width: 980px; margin: 0 auto; padding: 16px; display:flex; flex-direction:column; gap: 12px; }
    header { display:flex; align-items:flex-start; justify-content:space-between; gap: 12px; flex-wrap: wrap; }
    .title { display:flex; flex-direction:column; gap: 4px; }
    h1 { margin:0; font-size: 18px; letter-spacing: .2px; }
    .sub { margin:0; color:var(--muted); font-size: 13px; line-height: 1.35; }
    .pillrow { display:flex; gap: 8px; flex-wrap: wrap; align-items:center; }
    .pill {
      border:1px solid rgba(255,255,255,.10);
      background: rgba(18,26,39,.6);
      padding: 8px 10px;
      border-radius: 999px;
      color: var(--text);
      font-size: 13px;
      display:flex; align-items:center; gap:8px;
      backdrop-filter: blur(6px);
    }
    .pill input, .pill select {
      background: transparent; color: var(--text);
      border: none; outline: none; font-size: 13px;
    }
    .pill input { width: 64px; text-align:right; }
    .tabs { display:flex; gap: 8px; flex-wrap: wrap; }
    .tab {
      cursor:pointer;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(18,26,39,.35);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      transition: transform .06s ease, background .2s ease;
      user-select:none;
    }
    .tab:hover { background: rgba(18,26,39,.55); }
    .tab:active { transform: scale(.98); }
    .tab.active { border-color: rgba(106,166,255,.7); box-shadow: 0 0 0 3px rgba(106,166,255,.18); }
    .grid { display:grid; grid-template-columns: 1.2fr .8fr; gap: 12px; }
    @media (max-width: 860px){ .grid { grid-template-columns: 1fr; } }
    .card {
      background: rgba(18,26,39,.55);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 16px 40px rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
    }
    .card h2 { margin: 0 0 8px 0; font-size: 14px; color: var(--muted); font-weight: 600; letter-spacing:.2px; }
    .bigcard { min-height: 260px; display:flex; flex-direction: column; gap: 10px; }
    .flash {
      flex: 1;
      border-radius: 16px;
      border:1px dashed rgba(255,255,255,.18);
      padding: 14px;
      display:flex;
      flex-direction: column;
      justify-content: center;
      gap: 10px;
      cursor: pointer;
      user-select:none;
    }
    .word { font-size: 26px; font-weight: 800; letter-spacing:.2px; }
    .def  { font-size: 15px; color: rgba(234,241,255,.92); line-height: 1.35; }
    .hint { font-size: 12px; color: var(--muted); }
    .row { display:flex; gap: 8px; flex-wrap: wrap; }
    button {
      cursor:pointer;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(18,26,39,.55);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    button:hover { background: rgba(18,26,39,.75); }
    button:active { transform: scale(.98); }
    button:disabled { opacity:.55; cursor:not-allowed; }
    .primary { border-color: rgba(106,166,255,.7); background: rgba(106,166,255,.14); }
    .good { border-color: rgba(47,229,155,.7); background: rgba(47,229,155,.12); }
    .warn { border-color: rgba(255,204,102,.7); background: rgba(255,204,102,.12); }
    .bad  { border-color: rgba(255,106,122,.7); background: rgba(255,106,122,.12); }
    .mini { padding: 8px 10px; border-radius: 10px; }
    .list { display:flex; flex-direction: column; gap: 8px; max-height: 420px; overflow:auto; padding-right: 6px; }
    .item {
      border:1px solid rgba(255,255,255,.10);
      background: rgba(18,26,39,.45);
      border-radius: 14px;
      padding: 10px;
      display:flex;
      flex-direction: column;
      gap: 6px;
    }
    .itemtop { display:flex; justify-content: space-between; gap: 8px; align-items:flex-start; }
    .itemw { font-weight: 800; }
    .itemd { color: var(--muted); font-size: 13px; line-height: 1.35; }
    .badge { font-size: 12px; padding: 3px 8px; border-radius: 999px; border:1px solid rgba(255,255,255,.14); color: var(--muted); }
    .badge.known { border-color: rgba(47,229,155,.5); color: rgba(47,229,155,.95); }
    .badge.hard  { border-color: rgba(255,204,102,.55); color: rgba(255,204,102,.95); }
    .bar {
      height: 10px; border-radius: 999px; background: rgba(255,255,255,.08);
      overflow:hidden; border:1px solid rgba(255,255,255,.10);
    }
    .bar > div { height:100%; width: 0%; background: rgba(106,166,255,.85); }
    .muted { color: var(--muted); }
    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px; padding: 2px 6px; border:1px solid rgba(255,255,255,.14);
      border-bottom-width: 2px; border-radius: 8px; color: var(--muted);
    }
    .footer { color: var(--muted); font-size: 12px; line-height: 1.4; }
    .search { width: 100%; padding: 10px 12px; border-radius: 12px;
      border:1px solid rgba(255,255,255,.12); background: rgba(18,26,39,.4); color: var(--text); outline:none; }
    .quizbox { display:flex; flex-direction:column; gap: 8px; }
    .quizbox input { width:100%; padding: 10px 12px; border-radius: 12px;
      border:1px solid rgba(255,255,255,.12); background: rgba(18,26,39,.4); color: var(--text); outline:none; }
    .toast {
      position: fixed; left: 50%; bottom: 16px; transform: translateX(-50%);
      background: rgba(18,26,39,.85); border:1px solid rgba(255,255,255,.14);
      padding: 10px 12px; border-radius: 12px; color: var(--text); font-size: 13px;
      opacity:0; pointer-events:none; transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show { opacity:1; transform: translateX(-50%) translateY(-4px); }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <h1>CELPIP Daily Vocab (400)</h1>
      <p class="sub">Tap the card to flip. Progress saves locally and (if you sign in) syncs across devices.</p>

      <!-- AUTH UI (Email + Password) -->
      <div class="pillrow" id="authBox" style="margin-top:8px; gap:8px;">
        <div class="pill">
          <span class="muted">Email</span>
          <input id="emailInput" type="email" placeholder="you@email.com" style="width:190px;text-align:left;" />
        </div>
        <div class="pill">
          <span class="muted">Password</span>
          <input id="passwordInput" type="password" placeholder="••••••••" style="width:150px;text-align:left;" />
        </div>
        <button class="mini primary" id="signInBtn">Sign in</button>
        <button class="mini" id="signUpBtn">Sign up</button>
        <button class="mini" id="logoutBtn" style="display:none;">Log out</button>
        <div class="footer" id="authStatus" style="max-width:520px;"></div>
      </div>

      <div class="footer" style="margin-top:4px;">
        Tip: if you turned on “Confirm email” in Supabase, you’ll need to confirm your email once after signing up.
      </div>
    </div>

    <div class="pillrow">
      <div class="pill" title="How many new words to learn each day">
        <span class="muted">Words/day</span>
        <input id="perDay" type="number" min="5" max="50" step="1" value="10" />
      </div>
      <div class="pill" title="Choose what the main card pulls from">
        <span class="muted">Deck</span>
        <select id="deckMode">
          <option value="today">Today</option>
          <option value="hard">Hard</option>
          <option value="all">All</option>
        </select>
      </div>
      <button class="mini bad" id="resetBtn" title="Clears Known/Hard marks (local + cloud)">Reset Progress</button>
    </div>
  </header>

  <div class="tabs">
    <div class="tab active" data-tab="learn">Learn (Flashcards)</div>
    <div class="tab" data-tab="quiz">Quick Quiz</div>
    <div class="tab" data-tab="browse">Browse & Search</div>
    <div class="tab" data-tab="stats">Stats</div>
  </div>

  <div class="grid">
    <section class="card bigcard" id="mainPanel">
      <h2 id="panelTitle">Learn</h2>

      <!-- Flashcard -->
      <div id="flashPanel">
        <div class="flash" id="flashCard" role="button" tabindex="0" aria-label="Flashcard (tap to flip)">
          <div class="word" id="flashWord">—</div>
          <div class="def" id="flashDef" style="display:none;">—</div>
          <div class="hint" id="flashHint">Tap to reveal definition • <span class="kbd">Space</span> flip • <span class="kbd">←</span>/<span class="kbd">→</span> prev/next • <span class="kbd">K</span> known • <span class="kbd">H</span> hard</div>
        </div>
        <div class="row">
          <button class="mini primary" id="prevBtn">← Prev</button>
          <button class="mini primary" id="nextBtn">Next →</button>
          <button class="mini good" id="knownBtn">Known ✓</button>
          <button class="mini warn" id="hardBtn">Hard ★</button>
        </div>
        <div class="bar" aria-label="Progress bar"><div id="progressBar"></div></div>
        <div class="footer" id="progressText"></div>
      </div>

      <!-- Quiz -->
      <div id="quizPanel" style="display:none;">
        <div class="quizbox">
          <div class="muted">Type the <b>meaning</b> (or a close synonym). Then check.</div>
          <div class="flash" id="quizCard" style="cursor:default;">
            <div class="word" id="quizWord">—</div>
            <div class="def" id="quizAnswer" style="display:none;">—</div>
            <div class="hint">Tip: you don’t need perfect wording — just be close.</div>
          </div>
          <input id="quizInput" placeholder="Meaning / synonym..." />
          <div class="row">
            <button class="mini primary" id="checkBtn">Check</button>
            <button class="mini primary" id="revealBtn">Reveal</button>
            <button class="mini good" id="quizKnownBtn">Mark Known ✓</button>
            <button class="mini warn" id="quizHardBtn">Mark Hard ★</button>
            <button class="mini" id="newQuizBtn">New Word</button>
          </div>
          <div class="footer" id="quizFeedback"></div>
        </div>
      </div>

      <!-- Browse -->
      <div id="browsePanel" style="display:none;">
        <input id="searchInput" class="search" placeholder="Search word or meaning…" />
        <div class="footer">Tap a result to load it into the main card.</div>
        <div class="list" id="searchList"></div>
      </div>

      <!-- Stats -->
      <div id="statsPanel" style="display:none;">
        <div class="item">
          <div class="itemtop">
            <div>
              <div class="itemw">Your Progress</div>
              <div class="itemd">Known = mastered (for now). Hard = needs extra review.</div>
            </div>
          </div>
          <div class="row" style="margin-top:6px;">
            <div class="pill"><span class="muted">Total</span> <span id="stTotal">—</span></div>
            <div class="pill"><span class="muted">Known</span> <span id="stKnown">—</span></div>
            <div class="pill"><span class="muted">Hard</span> <span id="stHard">—</span></div>
            <div class="pill"><span class="muted">Unseen</span> <span id="stUnseen">—</span></div>
          </div>
          <div class="footer" style="margin-top:8px;">
            Pro tip: keep Words/day at 10–20 and revisit “Hard” until it shrinks.
          </div>
        </div>

        <div class="item">
          <div class="itemw">Backup / Transfer (optional)</div>
          <div class="itemd">Export/import progress manually (useful as a backup even with sync).</div>
          <div class="row" style="margin-top:8px;">
            <button class="mini primary" id="exportBtn">Export JSON</button>
            <button class="mini primary" id="importBtn">Import JSON</button>
          </div>
          <input id="importFile" type="file" accept="application/json" style="display:none;" />
          <div class="footer" id="backupNote"></div>
        </div>
      </div>
    </section>

    <aside class="card">
      <h2>Today’s List</h2>
      <div class="footer" id="todayMeta"></div>
      <div class="list" id="todayList"></div>
      <div class="footer" style="margin-top:10px;">
        Tip: switch Deck → <b>Hard</b> to focus on tough words.
      </div>
    </aside>
  </div>

  <div class="footer">
    Data stays on your device (localStorage). If you sign in, your progress also syncs to your Supabase account.
  </div>
</div>

<div class="toast" id="toast">Saved</div>

<script>
/* =========================================================
   SUPABASE CONFIG (put your values here)
   ========================================================= */
const SUPABASE_URL = "YOUR_SUPABASE_URL";            // e.g. https://xxxxx.supabase.co
const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";  // anon public key (long string)

// We DO NOT declare any variable named `supabase`.
// window.supabase = library (from CDN)
// sb = your client instance (single declaration)
const sb = (SUPABASE_URL.startsWith("https://") && SUPABASE_URL.includes(".supabase.co") && SUPABASE_ANON_KEY.length > 20)
  ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
  : null;

/* ===========================
   1) Word data
   =========================== */
const RAW = `
1. blurry - not clear
2. cozy - comfortable
3. rigorous - detailed or thorough
4. rehearse - practice
5. allege - blame
6. convict - criminal (noun) or criminally charging someone (verb)
7. testify - to bear witness
8. verdict - final decision
9. adore - appreciate
10. envy - be jealous of someone (verb)
11. enthusiasm - eagerness
12. brag - show off
13. cautious - careful
14. affection - love or emotions
15. fond - proud of
16. poverty - lack of money
17. tenant (the one renting) and landlord (the owner of the premises)
18. slogan - saying (mostly of companies)
19. valuable - important
20. crew - group
21. harvest - to take out crops when they are fully grown
22. prosper - to be successful
23. possess - own something
24. shallow - not deep
25. fluid - water like substance
26. decay - go bad
27. batch - group
28. aftermath - after events
29. plethora - a lot of
30. temper - mood
31. postpone - delay
32. conceal - hide
33. swap - exchange
34. exhaust - use up
35. shrink - become small
36. tremble - shake
37. soak - make wet in the water
38. timid - shy
39. urge - persuade
40. agitate - disturb
41. absolute - the most or the greatest
42. classify - to attach a name to something
43. scaffolding - outer structure
44. supplant - replace
45. aura - vibes
46. focal - point of focus
47. astray - go away from the right path
48. pursue - run after
49. aggregate - total
50. explicit - to make clear
51. deviate - move away from course
52. arbitrary - based on random judgement
53. predominant - powerful
54. indifferent - not caring
55. reinforce - remind
56. considerable - a lot
57. constrain - to limit someone
58. convene - to come together
59. correspond - matches with
60. demonstrate - show
61. specify - to give a title or assign a position
62. impose - force
63. implicate - to suggest something
64. subsequent - next
65. despite - instead
66. hypothesis - to assume after considering various options
67. draft - rough version
68. evolve - to grow
69. equivalent - equal version
70. adapting - getting used to something
71. advocate - support
72. equip - to gift you with some tool
73. empirical - based on facts
74. contrary - opposite
75. ideology - a set of beliefs
76. hierarchy - a system of a management structure
77. intervene - interrupt
78. successor - one taking the office after you
79. predecessor - one taking the office before you
80. undertake - to take the responsibility of doing a task
81. ignorant - people who are not fully aware of situations with complete information
82. interval - periods of time
83. paradigm - a way of thinking
84. deviate - move from the current course of action
85. simulate - copy
86. distort - to change the shape of something
87. sphere - round object
88. restrain - stop someone from doing something
89. minimal - very little
90. preliminary - initial stages
91. norm - commonly accepted
92. confine - limit someone or something
93. cease - stop
94. coherent - organized
95. coincide - happen at the same time
96. attain - to get something tangible or intangible
97. erode - erase
98. integral - important
99. rigid - difficult to change
100. concurrent - same as current
101. underlie - to be the cause of something
102. initiate - start
103. inhibit - to prevent something from growing
104. explicit - detailed instructions (adjective)
105. cite - to use something as a legitimate example
106. clause - a part of a legal agreement
107. facilitate - help someone achieve something
108. legit - (informal) legal
109. discreet - careful in one's actions
110. enabler - someone who encourages someone else
111. detractor - opposite of enabler
112. disparage - degrade
113. dogma - a set of firm believes
114. impulsive - acting on impulse without thinking
115. bash - hurt someone physically or verbally
116. abstract - existing in mind, not real
117. abysmal - terrible
118. clinical - not emotionally involved
119. conceive - come up with an idea
120. conducive - suited to
121. confide - express real feelings
122. dubious - doubtful
123. eloquent - very expressive
124. envy - to be jealous
125. imprudent - rude
126. scandalous - morally offensive
127. surmount - to overcome
128. validate - to prove
129. unveil - make something possible
130. vital - necessary
131. exceptional - instead of "good"
132. recent - instead of "new"
133. lingering - instead of "long"
134. decaying - instead of "old"
135. precise - instead of "right"
136. odd or exotic - instead of "different"
137. immense or massive - instead of "large"
138. youthful - instead of "young"
139. sparsely - instead of "never"
140. belongings - instead of "things"
141. discern - instead of "feel"
142. come across as - instead of "seem"
143. hardly - instead of "just"
144. upcoming - instead of "next"
145. plausible - instead of "possible"
146. ambiguous - not clear
147. conform - to agree with the norm
148. evident - clear
149. implicate - to accuse someone of being involved in a crime or something negative
150. append - fix or attach
151. partisan - biased
152. discrete - separate
153. infer - conclude
154. inherent - something existing as a characteristic
155. reluctance - unwillingness
156. precede - come earlier in sequence
157. offset - use something as compensation
158. prognosticate - predict (something serious)
159. mediate - reconcile differences between two parties
160. rigid - stubborn, not moving
161. abate - to lessen
162. adversity - problematic situations
163. brazen - bold
164. condescending - looking down on someone
165. mundane - boring
166. reverence - deep respect
167. prosperity - wealth
168. canny - careful
169. disdain - to show hate
170. intuitive - knowing something with intuition
171. spontaneous - do something without thinking/abruptly
172. superfluous - unnecessary
173. null - void
174. vindicate - to free from blame
175. entail - involve
176. arid - very dry
177. frugal - stingy
178. convergence - coming together
179. diligent - hardworking
180. intrepid - fearless
181. orator - speaker
182. parched - when something is dried up
183. reclusive - avoiding other people
184. reconciliation - bringing people together
185. haughty - being arrogant
186. aberration - something unusual
187. jubilation - extreme happiness
188. apex - top or high point
189. capacious - having a lot of space
190. delirious - not being in a normal state of mind
191. kindle - start a fire
192. noxious - lethal
193. hangar - storage area for a plane
194. cower - move as in you are in fear
195. tangible - can be touched
196. credible - believable
197. tardy - sluggish
198. blatant - obvious
199. hasten - make something faster
200. abstain - avoid something
201. repudiate - nullify something
202. cringe - become uncomfortable
203. tenacious - aggressive or stubborn
204. cryptic - puzzling
205. lampoon - ridiculous
206. admonish - scold
207. alias - temporary name
208. assiduous - similar to hardworking
209. circumvent - surround the enemy to make them give up
210. cognizant - knowledgeable or aware about something
211. debacle - complete disaster
212. debunk - clarify a mystery
213. eclectic - a dynamic range of something
214. emulate - to copy someone as a role model
215. hapless - something that fails and deserves pity
216. incontrovertible - something that cannot be denied
217. negligent - someone not paying attention to their duties
218. insidious - something hidden and harmful
219. laconic - to the point
220. maverick - someone who shows independence
221. amorphous - no shape
222. candor - being straightforward
223. capitulate - surrender
224. conduit - a passage
225. disrepute - bringing low respect
226. duplicity - the act of being fake
227. fallacious - based on the wrong reasoning
228. linchpin - a central authority
229. ostensible - looks that appear as something but are actually deceiving
230. proclivity - the intention or inclination to do something
231. ramble - to go off saying things continuously which are not relevant
232. vilify - make someone the bad guy
233. languish - lose beauty or charm
234. pariah - a social outcast
235. maxim - short statement backed by facts
236. aggrandize - to enhance power
237. beguile - to influence in a deceptive way
238. archetypal - typical
239. callous - disregard for others
240. cognizant - being aware of something
241. construe - the way something is interpreted
242. disparate - completely different
243. denigrate - criticize harshly
244. idiosyncratic - something unique about someone
245. inveterate - habitual
246. multifarious - diverse
247. largesse - generosity
248. obdurate - stubborn
249. promulgate - to spread or broadcast
250. phlegmatic - showing no emotion
251. accord - something consistent with the other or in agreement
252. astounding - amazing
253. armored - fully sealed or protected
254. divest - to deprive someone something
255. debrief - to question someone
256. docile - obedient
257. fluster - to confuse someone
258. fetter - to bound or restrain someone
259. fuse - to mix or blend together
260. rudimentary - basic
261. tempest - violent or windy storm
262. taint - to make something worse or ugly
263. tactless - not showing sensitivity or care
264. adroit - full of talent
265. pep talk - encouraging words
266. proclaim - declare something of importance
267. lethargic - lazy
268. considerable - great
269. downright - complete or total
270. explicit - clear or detailed
271. forthright - straightforward and honest
272. full-blown - massive
273. constrain - compel someone
274. vehement - showing strong passion
275. dawdle - to waste time
276. retardment - the delay in processing something
277. showstopper - something that deserves applause
278. cessation - stopping something
279. expedition - a quest to discover something
280. hustle - to get something by forceful action
281. engrossed - completely occupied in some activity
282. astute - very smart or sharp
283. visceral - something inside your body OR a deep feeling
284. lateral - at or toward or the side. It points to something
285. presumptuous - someone who does not know what is appropriate in certain situations
286. oversight - missing something while making analysis
287. pretentious - faking something or showing off
288. win-win - when both sides win
289. push the envelope - push the limits of something
290. bending backwards - to try something really difficult
291. rustic - plain and very simple
292. proactive - responding to situations with your feelings or attitude rather than reacting to them
293. reimagine - think of something again
294. higher order thinking - thinking beyond simple memorization
295. ballpark - rough estimate
296. core competency - your advantage that distinguishes you from others
297. entitlement - your privilege to have something
298. holistic - the complete thing
299. toil - hard work (noun) OR to do hard work (verb)
300. pester - to annoy someone
301. porringer - a small bowl
302. backhaul - return trip of a vehicle
303. gaslight - to manipulate someone
304. awfulize - to make something sound awful
305. hench - a muscular, strong person
306. microtarget - to target a person or people based on all data available about them
307. patient zero - the first patient identified of a certain disease
308. sadfishing - using social media to exaggerate one's pain in order to gain sympathy
309. amplify - make something bigger
310. unfathom - starting to comprehend something
311. dread - feeling of fear
312. anxiety - nervousness or feeling alarmed
313. grief - feeling of sorrow
314. bland - tasteless
315. ache - pain
316. fatigue - tiredness
317. sanitary - related to health
318. sore - part of your body under pain
319. trauma - physical or mental pain
320. slender - thin
321. bruise - injury
322. bargain - to argue
323. affiliate - to link
324. surplus - excess of something
325. venture - business activity involving risks
326. feasible - (positive replacement idea)
327. persistent - (positive replacement idea)
328. conviction - (positive replacement idea)
329. fate - (positive replacement idea)
330. faith - (positive replacement idea)
331. optimistic - (positive replacement idea)
332. ample - (positive replacement idea)
333. contended - (positive replacement idea)
334. passionate - (positive replacement idea)
335. flourish - (positive replacement idea)
336. ardent - (positive replacement idea)
337. overcome - (positive replacement idea)
338. merit - (positive replacement idea)
339. destined - (positive replacement idea)
340. emboldened - (positive replacement idea)
341. lively - fun or full of life
342. thrilling - exciting
343. festivity - party
344. dine - eat food
345. tango - dance (more used in formal/ballroom type dances)
346. relish - enjoy
347. gratifying - enjoyable
348. ecstatic - very happy
349. giggle - laugh
350. holler - scream
351. mingle - socialize
352. grin - smile
353. berserk - crazy
354. fooling around - acting like a crazy person
355. jest - to express a joke
356. irate - angry
357. antagonize - make someone irritated
358. salty - irritated (informal)
359. pissed off - angry (informal)
360. exacerbate - make something worse
361. sulky - uncooperative or bad-tempered
362. resentful - hateful of somebody
363. abhor - have disgust for something (verb)
364. queasy - feeling nauseated
365. had it with / sick and tired of - completely annoyed with someone or something
366. appalled - horrified with something or someone
367. denounce - accuse
368. disparage - degrade
369. belittle - make someone feel unimportant
370. patronize - insult someone in a way to degrade them
371. chaotic - full of craziness or chaos
372. segregated - discriminative (mandates dividing people)
373. progressive - something that progresses into something positive
374. turbulent - fluctuating wildly
375. unnerving - causing one to lose courage
376. intriguing - interesting
377. unearthing - discovering something new
378. prodigious - amazing
379. ominous - scary
380. cutthroat - competitive
381. shortsighted - silly
382. aggrandizement - growth
383. coercive - forceful
384. comical - laughable
385. historical - something that will be remembered
386. questionable - controversial
387. looks sharp - handsome
388. leftist - communist
389. collected - calm and soft-spoken
390. fascist - dictator
391. triumphant - successful
392. crook - corrupt
393. amiable - polite and friendly
394. diplomatic - someone who never picks a side
395. efficacious - efficient or active
396. squanderer - someone who spends money without thinking
397. strategic - careful in strategy
398. megalomaniac - hungry for power
399. affluent - rich
400. acclaimed - known for
`.trim();

/* Parse lines into {id, w, d} */
function parseWords(raw) {
  const out = [];
  const lines = raw.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
  for (const line of lines) {
    const m = line.match(/^(\d+)\.\s*(.+?)\s*[-:]\s*(.+)$/);
    if (m) { out.push({ id: Number(m[1]), w: m[2].trim(), d: m[3].trim() }); continue; }
    const m2 = line.match(/^(\d+)\.\s*(.+)$/);
    if (m2) out.push({ id: Number(m2[1]), w: m2[2].trim(), d: "" });
  }
  out.sort((a,b)=>a.id-b.id);
  return out;
}
const WORDS = parseWords(RAW);

/* ===========================
   2) Storage + helpers
   =========================== */
const LS_KEY = "celpip_vocab_progress_v4_pw";

function loadProgress() {
  try {
    const data = JSON.parse(localStorage.getItem(LS_KEY) || "{}");
    return {
      known: new Set(data.known || []),
      hard: new Set(data.hard || []),
      perDay: Number.isFinite(data.perDay) ? data.perDay : 10,
      deckMode: data.deckMode || "today"
    };
  } catch {
    return { known:new Set(), hard:new Set(), perDay:10, deckMode:"today" };
  }
}

function saveProgressLocal(silent=false) {
  const data = {
    known: [...state.known],
    hard: [...state.hard],
    perDay: state.perDay,
    deckMode: state.deckMode
  };
  localStorage.setItem(LS_KEY, JSON.stringify(data));
  if (!silent) toast("Saved");
}

function todayKey() {
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const da = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${da}`;
}

/* Deterministic seeded RNG */
function mulberry32(seed) {
  return function() {
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
function hashStr(s) {
  let h = 2166136261;
  for (let i=0;i<s.length;i++){
    h ^= s.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}
function shuffledIndices(n, seedStr) {
  const rng = mulberry32(hashStr(seedStr));
  const arr = Array.from({length:n}, (_,i)=>i);
  for (let i=n-1; i>0; i--) {
    const j = Math.floor(rng() * (i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* Similarity check */
function normalize(s) { return (s||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(); }
function tokenSet(s) { return new Set(normalize(s).split(" ").filter(Boolean)); }
function overlapScore(a,b) {
  const A = tokenSet(a), B = tokenSet(b);
  if (!A.size || !B.size) return 0;
  let inter = 0;
  for (const t of A) if (B.has(t)) inter++;
  return inter / Math.max(A.size, B.size);
}

/* Toast */
let toastTimer = null;
function toast(msg) {
  const el = document.getElementById("toast");
  el.textContent = msg;
  el.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>el.classList.remove("show"), 900);
}

/* Escape */
function escapeHtml(s) {
  return (s ?? "").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c]));
}

/* ===========================
   3) App state
   =========================== */
const state = loadProgress();
state.todayIdxs = [];
state.deck = [];
state.pos = 0;
state.flipped = false;
state.activeTab = "learn";
state.quizItem = null;
state.quizRevealed = false;

/* ===========================
   4) DOM refs
   =========================== */
const perDayEl = document.getElementById("perDay");
const deckModeEl = document.getElementById("deckMode");
const panelTitleEl = document.getElementById("panelTitle");

const flashPanel = document.getElementById("flashPanel");
const flashCard = document.getElementById("flashCard");
const flashWord = document.getElementById("flashWord");
const flashDef  = document.getElementById("flashDef");

const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const knownBtn = document.getElementById("knownBtn");
const hardBtn = document.getElementById("hardBtn");

const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");

const todayMeta = document.getElementById("todayMeta");
const todayList = document.getElementById("todayList");

const quizPanel = document.getElementById("quizPanel");
const quizWord = document.getElementById("quizWord");
const quizAnswer = document.getElementById("quizAnswer");
const quizInput = document.getElementById("quizInput");
const quizFeedback = document.getElementById("quizFeedback");
const checkBtn = document.getElementById("checkBtn");
const revealBtn = document.getElementById("revealBtn");
const quizKnownBtn = document.getElementById("quizKnownBtn");
const quizHardBtn = document.getElementById("quizHardBtn");
const newQuizBtn = document.getElementById("newQuizBtn");

const browsePanel = document.getElementById("browsePanel");
const searchInput = document.getElementById("searchInput");
const searchList = document.getElementById("searchList");

const statsPanel = document.getElementById("statsPanel");
const stTotal = document.getElementById("stTotal");
const stKnown = document.getElementById("stKnown");
const stHard = document.getElementById("stHard");
const stUnseen = document.getElementById("stUnseen");
const exportBtn = document.getElementById("exportBtn");
const importBtn = document.getElementById("importBtn");
const importFile = document.getElementById("importFile");
const backupNote = document.getElementById("backupNote");

const resetBtn = document.getElementById("resetBtn");

/* Auth refs */
const emailInput = document.getElementById("emailInput");
const passwordInput = document.getElementById("passwordInput");
const signInBtn = document.getElementById("signInBtn");
const signUpBtn = document.getElementById("signUpBtn");
const logoutBtn = document.getElementById("logoutBtn");
const authStatus = document.getElementById("authStatus");

/* ===========================
   5) Deck building
   =========================== */
function buildToday() {
  const n = Math.max(5, Math.min(50, Number(perDayEl.value || 10)));
  state.perDay = n;
  const idxs = shuffledIndices(WORDS.length, "today|" + todayKey());
  state.todayIdxs = idxs.slice(0, n);
}

function buildDeck() {
  const mode = deckModeEl.value;
  state.deckMode = mode;

  if (mode === "today") {
    state.deck = state.todayIdxs.map(i => WORDS[i]);
  } else if (mode === "hard") {
    const hardItems = WORDS.filter(x => state.hard.has(x.id));
    state.deck = hardItems.length ? hardItems : state.todayIdxs.map(i => WORDS[i]);
  } else {
    state.deck = WORDS.slice();
  }

  state.pos = Math.max(0, Math.min(state.pos, state.deck.length - 1));
  state.flipped = false;
}

function currentItem() {
  if (!state.deck.length) return null;
  return state.deck[state.pos];
}

/* ===========================
   6) Rendering
   =========================== */
function renderFlash() {
  const item = currentItem();
  if (!item) {
    flashWord.textContent = "No words found";
    flashDef.textContent = "";
    return;
  }

  flashWord.textContent = item.w;
  flashDef.textContent = item.d || "(No definition provided in list)";
  flashDef.style.display = state.flipped ? "block" : "none";

  const pct = state.deck.length ? Math.round(((state.pos+1)/state.deck.length)*100) : 0;
  progressBar.style.width = pct + "%";

  const flags = [];
  if (state.known.has(item.id)) flags.push("Known ✓");
  if (state.hard.has(item.id)) flags.push("Hard ★");
  const flagText = flags.length ? ` • ${flags.join(" • ")}` : "";
  progressText.textContent = `${state.pos+1} / ${state.deck.length} (${pct}%)${flagText}`;
}

function renderTodayList() {
  todayList.innerHTML = "";
  const items = state.todayIdxs.map(i => WORDS[i]);
  const key = todayKey();
  todayMeta.textContent = `Date: ${key} • ${items.length} words`;

  items.forEach((it, idx) => {
    const div = document.createElement("div");
    div.className = "item";
    div.style.cursor = "pointer";
    div.innerHTML = `
      <div class="itemtop">
        <div class="itemw">${idx+1}. ${escapeHtml(it.w)}</div>
        <div class="row" style="gap:6px;">
          ${state.known.has(it.id) ? `<span class="badge known">Known</span>` : ""}
          ${state.hard.has(it.id) ? `<span class="badge hard">Hard</span>` : ""}
        </div>
      </div>
      <div class="itemd">${escapeHtml(it.d || "")}</div>
    `;
    div.addEventListener("click", () => {
      if (state.deckMode !== "today") {
        deckModeEl.value = "today";
        buildDeck();
      }
      const pos = state.deck.findIndex(x => x.id === it.id);
      if (pos >= 0) state.pos = pos;
      state.flipped = false;
      renderAll();
      toast("Loaded");
    });
    todayList.appendChild(div);
  });
}

function renderStats() {
  stTotal.textContent = WORDS.length;
  stKnown.textContent = state.known.size;
  stHard.textContent = state.hard.size;
  stUnseen.textContent = Math.max(0, WORDS.length - state.known.size - state.hard.size);
}

function renderSearchList(query) {
  const q = normalize(query);
  const res = !q ? WORDS.slice(0, 30) : WORDS
    .map(it => {
      const score = Math.max(overlapScore(q, it.w), overlapScore(q, it.d));
      return { it, score };
    })
    .filter(x => x.score > 0.12)
    .sort((a,b)=>b.score-a.score)
    .slice(0, 60)
    .map(x=>x.it);

  searchList.innerHTML = "";
  res.forEach(it => {
    const div = document.createElement("div");
    div.className = "item";
    div.style.cursor = "pointer";
    div.innerHTML = `
      <div class="itemtop">
        <div class="itemw">${escapeHtml(it.id + ". " + it.w)}</div>
        <div class="row" style="gap:6px;">
          ${state.known.has(it.id) ? `<span class="badge known">Known</span>` : ""}
          ${state.hard.has(it.id) ? `<span class="badge hard">Hard</span>` : ""}
        </div>
      </div>
      <div class="itemd">${escapeHtml(it.d || "")}</div>
    `;
    div.addEventListener("click", () => {
      deckModeEl.value = "all";
      buildDeck();
      const pos = state.deck.findIndex(x => x.id === it.id);
      if (pos >= 0) state.pos = pos;
      state.flipped = false;
      switchTab("learn");
      renderAll();
      toast("Loaded");
    });
    searchList.appendChild(div);
  });
}

function renderQuiz() {
  if (!state.quizItem) {
    state.quizItem = pickQuizItem();
    state.quizRevealed = false;
  }
  quizWord.textContent = state.quizItem.w;
  quizAnswer.textContent = state.quizItem.d || "(No definition provided in list)";
  quizAnswer.style.display = state.quizRevealed ? "block" : "none";
  quizFeedback.textContent = "";
  quizInput.value = "";
  quizInput.focus();
}

function renderAll() {
  panelTitleEl.textContent =
    state.activeTab === "learn" ? "Learn" :
    state.activeTab === "quiz" ? "Quick Quiz" :
    state.activeTab === "browse" ? "Browse & Search" : "Stats";

  flashPanel.style.display  = state.activeTab === "learn" ? "block" : "none";
  quizPanel.style.display   = state.activeTab === "quiz" ? "block" : "none";
  browsePanel.style.display = state.activeTab === "browse" ? "block" : "none";
  statsPanel.style.display  = state.activeTab === "stats" ? "block" : "none";

  renderTodayList();
  renderFlash();
  if (state.activeTab === "browse") renderSearchList(searchInput.value);
  if (state.activeTab === "stats") renderStats();
  if (state.activeTab === "quiz") renderQuiz();

  saveProgressLocal(true);
}

/* ===========================
   7) Actions
   =========================== */
function flip() { state.flipped = !state.flipped; renderFlash(); }
function prev() { state.pos = (state.pos - 1 + state.deck.length) % state.deck.length; state.flipped = false; renderFlash(); }
function next() { state.pos = (state.pos + 1) % state.deck.length; state.flipped = false; renderFlash(); }

function ensureConsistency() {
  for (const id of state.known) state.hard.delete(id);
}

function markKnown() {
  const it = currentItem(); if (!it) return;
  state.known.add(it.id); state.hard.delete(it.id);
  saveProgress(); renderAll();
}
function markHard() {
  const it = currentItem(); if (!it) return;
  state.hard.add(it.id); state.known.delete(it.id);
  saveProgress(); renderAll();
}
function switchTab(name) {
  state.activeTab = name;
  document.querySelectorAll(".tab").forEach(t => t.classList.toggle("active", t.dataset.tab === name));
  renderAll();
}

/* Quiz helpers */
function pickQuizItem() {
  const hardItems = WORDS.filter(x => state.hard.has(x.id));
  const pool = hardItems.length ? hardItems : (state.todayIdxs.length ? state.todayIdxs.map(i=>WORDS[i]) : WORDS);
  return pool[Math.floor(Math.random()*pool.length)];
}
function checkQuiz() {
  if (!state.quizItem) return;
  const guess = quizInput.value;
  const ans = state.quizItem.d || "";
  const score = overlapScore(guess, ans);
  if (score >= 0.35) {
    quizFeedback.innerHTML = `<span style="color: rgba(47,229,155,.95); font-weight:700;">Nice!</span> That’s close enough.`;
  } else {
    quizFeedback.innerHTML = `<span style="color: rgba(255,204,102,.95); font-weight:700;">Not quite</span> — try another synonym or reveal.`;
  }
}
function revealQuiz() { state.quizRevealed = true; quizAnswer.style.display = "block"; }
function newQuizWord() { state.quizItem = pickQuizItem(); state.quizRevealed = false; renderQuiz(); }

/* Backup */
function exportJSON() {
  const payload = { version: 1, exportedAt: new Date().toISOString(), known: [...state.known], hard: [...state.hard], perDay: state.perDay, deckMode: state.deckMode };
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `celpip-vocab-progress-${todayKey()}.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
  backupNote.textContent = "Exported. Save that file somewhere safe.";
}
function importJSON(file) {
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const data = JSON.parse(reader.result);
      if (!data || !Array.isArray(data.known) || !Array.isArray(data.hard)) {
        backupNote.textContent = "That file doesn’t look like a valid export.";
        return;
      }
      state.known = new Set(data.known);
      state.hard = new Set(data.hard);
      if (Number.isFinite(data.perDay)) state.perDay = data.perDay;
      if (typeof data.deckMode === "string") state.deckMode = data.deckMode;
      ensureConsistency();
      perDayEl.value = state.perDay;
      deckModeEl.value = state.deckMode;
      saveProgress();
      backupNote.textContent = "Imported successfully.";
      buildToday(); buildDeck(); renderAll();
    } catch {
      backupNote.textContent = "Couldn’t read that JSON file.";
    }
  };
  reader.readAsText(file);
}

/* ===========================
   8) Supabase Auth + Sync (Email + Password)
   =========================== */
let currentUser = null;
let syncTimer = null;
let isApplyingRemote = false;

function setAuthUI({ loggedIn, message }) {
  authStatus.textContent = message || "";
  logoutBtn.style.display = loggedIn ? "inline-block" : "none";
  signInBtn.style.display = loggedIn ? "none" : "inline-block";
  signUpBtn.style.display = loggedIn ? "none" : "inline-block";
  emailInput.disabled = loggedIn;
  passwordInput.disabled = loggedIn;
}

async function signUp(email, password) {
  if (!sb) {
    setAuthUI({ loggedIn:false, message:"Sync disabled: add Supabase URL + anon key in the code." });
    return;
  }
  setAuthUI({ loggedIn:false, message:"Signing up..." });

  const { error } = await sb.auth.signUp({ email, password });

  if (error) {
    setAuthUI({ loggedIn:false, message:"Error: " + error.message });
    return;
  }

  // If email confirmation is enabled, user must confirm before they can sign in.
  setAuthUI({ loggedIn:false, message:"Signed up! If email confirmation is enabled, check your inbox to confirm, then sign in." });
}

async function signIn(email, password) {
  if (!sb) {
    setAuthUI({ loggedIn:false, message:"Sync disabled: add Supabase URL + anon key in the code." });
    return;
  }
  setAuthUI({ loggedIn:false, message:"Signing in..." });

  const { error } = await sb.auth.signInWithPassword({ email, password });

  if (error) {
    setAuthUI({ loggedIn:false, message:"Error: " + error.message });
    return;
  }
  // onAuthStateChange will do sync
}

async function signOut() {
  if (!sb) return;
  await sb.auth.signOut();
  currentUser = null;
  setAuthUI({ loggedIn:false, message:"Logged out (local-only mode)." });
}

function scheduleCloudSync() {
  if (!sb || !currentUser) return;
  if (isApplyingRemote) return;
  clearTimeout(syncTimer);
  syncTimer = setTimeout(() => pushProgressToCloud(false), 700);
}

function mergeRemoteIntoLocal(remote) {
  const remoteKnown = new Set(remote.known || []);
  const remoteHard = new Set(remote.hard || []);
  for (const id of remoteKnown) state.known.add(id);
  for (const id of remoteHard) state.hard.add(id);
  ensureConsistency();

  if (Number.isFinite(remote.per_day)) state.perDay = remote.per_day;
  if (typeof remote.deck_mode === "string") state.deckMode = remote.deck_mode;
  perDayEl.value = state.perDay;
  deckModeEl.value = state.deckMode;
}

async function loadProgressFromCloud() {
  if (!sb || !currentUser) return;

  setAuthUI({ loggedIn:true, message:"Signed in. Syncing..." });

  const { data, error } = await sb
    .from("progress")
    .select("known, hard, per_day, deck_mode")
    .eq("user_id", currentUser.id)
    .maybeSingle();

  if (error) {
    setAuthUI({ loggedIn:true, message:"Sync error: " + error.message });
    return;
  }

  isApplyingRemote = true;
  try {
    if (data) mergeRemoteIntoLocal(data);
    // Persist union back to cloud (and create row if missing)
    await pushProgressToCloud(false);
  } finally {
    isApplyingRemote = false;
  }

  buildToday(); buildDeck(); renderAll();
  setAuthUI({ loggedIn:true, message:"Signed in • Synced ✓" });
}

async function pushProgressToCloud(showToastMsg=false) {
  if (!sb || !currentUser) return;
  if (isApplyingRemote) return;

  const payload = {
    user_id: currentUser.id,
    known: [...state.known],
    hard: [...state.hard],
    per_day: state.perDay,
    deck_mode: state.deckMode
  };

  const { error } = await sb.from("progress").upsert(payload);

  if (error) {
    setAuthUI({ loggedIn:true, message:"Save error: " + error.message });
    return;
  }
  if (showToastMsg) toast("Synced");
}

/* Unified save (local + optional cloud) */
function saveProgress() {
  saveProgressLocal(false);
  scheduleCloudSync();
}

/* ===========================
   9) Wire up events
   =========================== */
document.querySelectorAll(".tab").forEach(t => t.addEventListener("click", () => switchTab(t.dataset.tab)));

flashCard.addEventListener("click", flip);
flashCard.addEventListener("keydown", (e) => {
  if (e.key === "Enter" || e.key === " ") { e.preventDefault(); flip(); }
});

prevBtn.addEventListener("click", prev);
nextBtn.addEventListener("click", next);
knownBtn.addEventListener("click", markKnown);
hardBtn.addEventListener("click", markHard);

perDayEl.addEventListener("change", () => {
  buildToday(); buildDeck();
  state.pos = 0; state.flipped = false;
  saveProgress(); renderAll();
});

deckModeEl.addEventListener("change", () => {
  buildDeck();
  state.pos = 0; state.flipped = false;
  saveProgress(); renderAll();
});

document.addEventListener("keydown", (e) => {
  if (state.activeTab !== "learn") return;
  if (e.key === "ArrowLeft") prev();
  if (e.key === "ArrowRight") next();
  if (e.key === " ") { e.preventDefault(); flip(); }
  if (e.key.toLowerCase() === "k") markKnown();
  if (e.key.toLowerCase() === "h") markHard();
});

searchInput.addEventListener("input", () => renderSearchList(searchInput.value));

checkBtn.addEventListener("click", checkQuiz);
revealBtn.addEventListener("click", revealQuiz);
newQuizBtn.addEventListener("click", newQuizWord);

quizKnownBtn.addEventListener("click", () => {
  if (!state.quizItem) return;
  state.known.add(state.quizItem.id);
  state.hard.delete(state.quizItem.id);
  saveProgress();
  toast("Marked Known");
  newQuizWord();
});
quizHardBtn.addEventListener("click", () => {
  if (!state.quizItem) return;
  state.hard.add(state.quizItem.id);
  state.known.delete(state.quizItem.id);
  saveProgress();
  toast("Marked Hard");
  newQuizWord();
});
quizInput.addEventListener("keydown", (e) => { if (e.key === "Enter") checkQuiz(); });

exportBtn.addEventListener("click", exportJSON);
importBtn.addEventListener("click", () => importFile.click());
importFile.addEventListener("change", (e) => {
  const f = e.target.files && e.target.files[0];
  if (f) importJSON(f);
  importFile.value = "";
});

resetBtn.addEventListener("click", async () => {
  if (!confirm("Reset Known/Hard progress? (Clears local; if signed in it will also clear cloud.)")) return;
  state.known.clear();
  state.hard.clear();
  saveProgress();
  renderAll();
  if (sb && currentUser) await pushProgressToCloud(true);
});

/* Auth buttons */
signUpBtn.addEventListener("click", async () => {
  const email = (emailInput.value || "").trim();
  const pw = (passwordInput.value || "").trim();
  if (!email || !pw) { setAuthUI({ loggedIn:false, message:"Enter email + password." }); return; }
  await signUp(email, pw);
});
signInBtn.addEventListener("click", async () => {
  const email = (emailInput.value || "").trim();
  const pw = (passwordInput.value || "").trim();
  if (!email || !pw) { setAuthUI({ loggedIn:false, message:"Enter email + password." }); return; }
  await signIn(email, pw);
});
passwordInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") signInBtn.click();
});
logoutBtn.addEventListener("click", signOut);

/* ===========================
   10) Boot app
   =========================== */
(function initApp() {
  perDayEl.value = state.perDay || 10;
  deckModeEl.value = state.deckMode || "today";
  ensureConsistency();
  buildToday(); buildDeck();
  state.pos = 0;
  renderAll();
})();

/* ===========================
   11) Boot auth
   =========================== */
(async function initAuth() {
  if (!sb) {
    setAuthUI({ loggedIn:false, message:"Sync disabled: add Supabase URL + anon key in the code." });
    return;
  }

  sb.auth.onAuthStateChange(async (_event, session) => {
    currentUser = session?.user || null;
    if (currentUser) {
      await loadProgressFromCloud();
    } else {
      setAuthUI({ loggedIn:false, message:"Not signed in (local-only mode)." });
    }
  });

  const { data } = await sb.auth.getSession();
  currentUser = data?.session?.user || null;

  if (currentUser) {
    await loadProgressFromCloud();
  } else {
    setAuthUI({ loggedIn:false, message:"Not signed in (local-only mode)." });
  }
})();
</script>
</body>
</html>
